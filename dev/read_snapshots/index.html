<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Reading Snapshots · GadgetIO.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">GadgetIO.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Table of Contents</a></li><li><a class="tocitem" href="../install/">Install</a></li><li><a class="tocitem" href="../file_infos/">File Infos</a></li><li class="is-active"><a class="tocitem" href>Reading Snapshots</a><ul class="internal"><li><a class="tocitem" href="#Filename"><span>Filename</span></a></li><li><a class="tocitem" href="#Reading-a-snapshot"><span>Reading a snapshot</span></a></li><li><a class="tocitem" href="#Full-snapshot"><span>Full snapshot</span></a></li><li><a class="tocitem" href="#Specific-blocks"><span>Specific blocks</span></a></li><li><a class="tocitem" href="#Read-Subvolumes"><span>Read Subvolumes</span></a></li><li><a class="tocitem" href="#Peano-Hilbert-key-based-reading"><span>Peano-Hilbert key based reading</span></a></li><li><a class="tocitem" href="#Brute-Force-Reading"><span>Brute-Force Reading</span></a></li><li><a class="tocitem" href="#Custom-Filtering"><span>Custom Filtering</span></a></li><li><a class="tocitem" href="#Reading-particles-by-referenced-ID"><span>Reading particles by referenced ID</span></a></li><li><a class="tocitem" href="#Example"><span>Example</span></a></li></ul></li><li><a class="tocitem" href="../read_subfind/">Reading Subfind</a></li><li><a class="tocitem" href="../write_data/">Writing Data</a></li><li><a class="tocitem" href="../read_cpu_files/">Reading CPU files</a></li><li><a class="tocitem" href="../api/">API reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Reading Snapshots</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Reading Snapshots</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/master/docs/src/read_snapshots.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Read-Snapshot-Data"><a class="docs-heading-anchor" href="#Read-Snapshot-Data">Read Snapshot Data</a><a id="Read-Snapshot-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Read-Snapshot-Data" title="Permalink"></a></h1><hr/><p><strong>NOTE</strong></p><p>From v0.4 and up snapshots are read in proper column-major order, as it should be for Julia. This means that position data for particle <code>i</code> neads be accessed as:</p><pre><code class="nohighlight hljs">x = pos[1,i]
y = pos[2,i]
z = pos[3,i]</code></pre><hr/><p><code>GadgetIO.jl</code> is specialized to read <code>Gadget</code> snapshots of <code>Format 2</code>. The structure of a <code>Format 2</code> snapshot is as follows:</p><pre><code class="nohighlight hljs">8              # size of the blockname block (Int32)
BLOCKNAME      # Blockname (4*Char)
8+SIZE_BLOCK   # number of bytes to skip if block should not be read
8              # end of blockname block

SIZE_BLOCK     # size of the current block in bytes
{...}          # content of the block ordered by particle type
SIZE_BLOCK     # end of the current block</code></pre><p>which repeats for every block.</p><h2 id="Filename"><a class="docs-heading-anchor" href="#Filename">Filename</a><a id="Filename-1"></a><a class="docs-heading-anchor-permalink" href="#Filename" title="Permalink"></a></h2><p>Before we get started, a short bit for clarification: In what follows we need to distinguish between <code>filename</code> and <code>filebase</code>. For small simulations the data is written to a single file. In that case you can simply supply an absolute, or relative path to the one snapshot file as <code>filename</code>.</p><p>For larger simulations the data may be distributed over multiple files, which again may be in individual snapshot directories. With the snapshots being distributed over multiple files you need to supply the base-name <code>filebase</code>. Assuming you want to read snapshot 140, which is in the snapshot directory 140 the <code>filebase</code> is</p><pre><code class="language-julia hljs">filebase = &quot;path/to/your/snapshot/directories/snapdir_140/snap_140&quot;</code></pre><p>In the relevant functions <code>GadgetIO.jl</code> will then automatically loop through the sub-snapshots which end in &quot;.0&quot;, &quot;.1&quot;, ... , &quot;.N&quot;.</p><h2 id="Reading-a-snapshot"><a class="docs-heading-anchor" href="#Reading-a-snapshot">Reading a snapshot</a><a id="Reading-a-snapshot-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-a-snapshot" title="Permalink"></a></h2><p>There are multiple ways to read the data in the snapshot</p><h2 id="Full-snapshot"><a class="docs-heading-anchor" href="#Full-snapshot">Full snapshot</a><a id="Full-snapshot-1"></a><a class="docs-heading-anchor-permalink" href="#Full-snapshot" title="Permalink"></a></h2><p>If you want to read a simulation snapshot into memory with <code>GadgetIO.jl</code>, it&#39;s as easy as this:</p><article class="docstring"><header><a class="docstring-binding" id="GadgetIO.read_snap" href="#GadgetIO.read_snap"><code>GadgetIO.read_snap</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">read_snap(filename::String [, blockname::String=&quot;&quot;, parttype::Integer=-1] )</code></pre><p>Wrapper function to read snapshot in various ways: filename only: returns the entire snapshot as a dictionary. blockname: Returns only that block. If parttype specified only for that particle type.</p><p><strong>Examples</strong></p><pre><code class="language-julia hljs">julia&gt; gas_pos = read_snap(filename, &quot;POS&quot;, 0)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/e189626f83f4cc5f59673e7f3a58ce439bbfb751/src/read_snapshot/read_snapshot.jl#L73-L86">source</a></section></article><p>This will return a dictionary with the header information in <code>data[&quot;Header&quot;]</code> and the blocks sorted by particle type.</p><p>As an example, this is how you would access the positions of the gas particles:</p><pre><code class="language-julia hljs">    data[&quot;Parttype0&quot;][&quot;POS&quot;]</code></pre><h2 id="Specific-blocks"><a class="docs-heading-anchor" href="#Specific-blocks">Specific blocks</a><a id="Specific-blocks-1"></a><a class="docs-heading-anchor-permalink" href="#Specific-blocks" title="Permalink"></a></h2><p>If you only want to read a specific block for a single particle type, e.g. positions of gas particles, you can use the function <code>read_block</code> with a specified blockname and particle type.</p><article class="docstring"><header><a class="docstring-binding" id="GadgetIO.read_block" href="#GadgetIO.read_block"><code>GadgetIO.read_block</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">read_block(filename::String, blockname::String;
            parttype::Integer=0,
            block_position::Integer=-1,
            info::Union{Nothing,InfoLine}=nothing,
            h::Union{Nothing,SnapshotHeader}=nothing,
            offset=0, n_to_read=-1)</code></pre><p>Reads a block in a snapshot with given name. Defaults to reading gas particles. Block Names are case sensitive.</p><p><strong>Keyword Arguments</strong></p><ul><li><code>parttype</code>: Which particle type to read (0-indexed)<ul><li><code>0</code>: Gas (default)</li><li><code>1</code>: Dark Matter</li><li><code>2</code>: Boundary</li><li><code>3</code>: Bulge</li><li><code>4</code>: Stars </li><li><code>5</code>: Black Holes</li><li><code>-1</code>: All particle types</li></ul></li><li><code>block_position</code>: Position of the block in the data file <code>[bytes]</code>. Can be used to speed up IO.</li><li><code>info</code>: <code>InfoLine</code> for the given block. Can be used to speed up IO, or if no <code>INFO</code> block is present.</li><li><code>h</code>: <code>SnapshotHeader</code> for given file. Can be used to speed up IO.</li><li><code>offset</code>: Adds an offset to start reading the block at a later point. Can be used for sub-IO.</li><li><code>n_to_read</code>: How many particles to read. Can be used for sub-IO.</li></ul><p><strong>Examples</strong></p><p>In case an <code>INFO</code> block is present:</p><pre><code class="language-julia hljs">gas_pos = read_block(filename, &quot;POS&quot;, parttype=0)</code></pre><p>If not you need to supply your own <code>InfoLine</code></p><pre><code class="language-julia hljs">pos_info = InfoLine(&quot;POS&quot;, Float32, 1, [1, 1, 1, 1, 1, 1])
gas_pos = read_block(filename, &quot;POS&quot;, info=pos_info, parttype=0)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/e189626f83f4cc5f59673e7f3a58ce439bbfb751/src/read_snapshot/read_format_2.jl#L1-L37">source</a></section></article><p>This will return an array of the datatype of your simulation, usually <code>Float32</code>.</p><p>If the snapshot has no info block this will fail unfortunately.</p><p>You can still read the specific block by supplying a hand-constructed <a href="../api/#GadgetIO.InfoLine"><code>InfoLine</code></a> struct and passing that to the function <a href="#GadgetIO.read_block"><code>read_block</code></a>:</p><pre><code class="language-julia hljs">pos_info = InfoLine(&quot;POS&quot;, Float32, 3, [1,1,1,1,1,1])
pos      = read_block(filename, &quot;POS&quot;, info=pos_info, parttype=0)</code></pre><p>I will collect some example <code>InfoLine</code> structs in a later release to be able to read some common blocks even without an <code>INFO</code> block.</p><p>Since <code>v0.5</code> <a href="#GadgetIO.read_snap"><code>read_snap</code></a> and <a href="#GadgetIO.read_block"><code>read_block</code></a> also work if you pass them a <code>file_base</code>.</p><p>Since <code>v0.7</code> <a href="#GadgetIO.read_block"><code>read_block</code></a> reads the full block if <code>parttype=-1</code> is set.</p><h2 id="Read-Subvolumes"><a class="docs-heading-anchor" href="#Read-Subvolumes">Read Subvolumes</a><a id="Read-Subvolumes-1"></a><a class="docs-heading-anchor-permalink" href="#Read-Subvolumes" title="Permalink"></a></h2><p>If you only want to read a subvolume of the whole simulation you can do this in two ways.</p><h3 id="Cubes"><a class="docs-heading-anchor" href="#Cubes">Cubes</a><a id="Cubes-1"></a><a class="docs-heading-anchor-permalink" href="#Cubes" title="Permalink"></a></h3><p>To get all particles within a cubic box of the simulation you can use the functions <a href="#GadgetIO.read_particles_in_box"><code>read_particles_in_box</code></a> or <a href="#GadgetIO.read_particles_in_volume"><code>read_particles_in_volume</code></a>.</p><p><a href="#GadgetIO.read_particles_in_box"><code>read_particles_in_box</code></a> takes a box defined by a lower-left corner and an upper-right corner and reads all requested blocks and particles in that volume.</p><article class="docstring"><header><a class="docstring-binding" id="GadgetIO.read_particles_in_box" href="#GadgetIO.read_particles_in_box"><code>GadgetIO.read_particles_in_box</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">read_particles_in_box(filename::String, blocks::Vector{String},
                    corner_lowerleft::Array{&lt;:Real}, corner_upperright::Array{&lt;:Real};
                    parttype::Integer=0, verbose::Bool=true,
                    use_keys::Bool=true)</code></pre><p>Reads all particles within a box defined by a lower left and upper right corner for a given particle type. Returns a dictionary with all requested blocks. If <code>use_keys=true</code> it uses Peano-Hilbert keys to constrain the read-in, otherwise it uses a brute-force read-in with a filter function. Peano-Hilbert key based read-in is significantly faster.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/e189626f83f4cc5f59673e7f3a58ce439bbfb751/src/read_snapshot/particles_in_box/read_particle_in_box.jl#L33-L43">source</a></section><section><div><pre><code class="language-julia hljs">read_particles_in_box(filename::String, block::String,
                      corner_lowerleft::Array{&lt;:Real}, corner_upperright::Array{&lt;:Real};
                      parttype::Integer=0, verbose::Bool=true,
                      use_keys::Bool=true)</code></pre><p>Like <code>read_particles_in_box</code> but for a single block. Returns the block as an array.</p><p>See also: <a href="../read_snapshots/#GadgetIO.read_particles_in_box"><code>read_particles_in_box</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/e189626f83f4cc5f59673e7f3a58ce439bbfb751/src/read_snapshot/particles_in_box/read_particle_in_box.jl#L63-L72">source</a></section></article><p>You can define an array of blocks you want to read, these will be read into a dictionary.</p><p><a href="#GadgetIO.read_particles_in_volume"><code>read_particles_in_volume</code></a> is a simple wrapper around <a href="#GadgetIO.read_particles_in_box"><code>read_particles_in_box</code></a>, where you can define a central position and a radius around it and it will construct the box containing that sphere for you and read all particles in it.</p><article class="docstring"><header><a class="docstring-binding" id="GadgetIO.read_particles_in_volume" href="#GadgetIO.read_particles_in_volume"><code>GadgetIO.read_particles_in_volume</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">read_particles_in_box(filename::String, blocks::Vector{String},
                      center_pos, radius;
                      parttype::Integer=0, verbose::Bool=true,
                      use_keys::Bool=true)</code></pre><p>Reads all particles within a box encapsulating a volume defined by center position and radius for a given particle type. Returns a dictionary with all requested blocks.</p><p>See also: <a href="../read_snapshots/#GadgetIO.read_particles_in_box"><code>read_particles_in_box</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/e189626f83f4cc5f59673e7f3a58ce439bbfb751/src/read_snapshot/particles_in_box/read_particle_in_box.jl#L85-L95">source</a></section><section><div><pre><code class="language-julia hljs">read_particles_in_box(filename::String, block::String,
                      center_pos, radius;
                      parttype::Integer=0, verbose::Bool=true)</code></pre><p>Like <code>read_particles_in_volume</code> but for a single block. Returns the block as an array.</p><p>See also: <a href="../read_snapshots/#GadgetIO.read_particles_in_volume"><code>read_particles_in_volume</code></a></p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/e189626f83f4cc5f59673e7f3a58ce439bbfb751/src/read_snapshot/particles_in_box/read_particle_in_box.jl#L108-L116">source</a></section></article><h3 id="Arbitrary-Geometries"><a class="docs-heading-anchor" href="#Arbitrary-Geometries">Arbitrary Geometries</a><a id="Arbitrary-Geometries-1"></a><a class="docs-heading-anchor-permalink" href="#Arbitrary-Geometries" title="Permalink"></a></h3><p>For reading particles in more complex geometries you can use</p><article class="docstring"><header><a class="docstring-binding" id="GadgetIO.read_particles_in_geometry" href="#GadgetIO.read_particles_in_geometry"><code>GadgetIO.read_particles_in_geometry</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">read_particles_in_geometry( filename::String, blocks::Vector{String},
                            geometry::AbstractGadgetGeometry;
                            parttype::Integer=0, verbose::Bool=true,
                            use_keys::Bool=true, do_shift_across_box_border::Bool=true)</code></pre><p>Reads all particles within a space defined by an <code>AbstractGeometry</code> struct for a given particle type.  Returns a dictionary with all requested blocks. If <code>shift_across_box_border</code> is <code>true</code>, the particles are moved beyond the borders of a periodic box, if <code>false</code>, the periodicity of the box is still accounted for, but the particles&#39; positions are not shifted.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/e189626f83f4cc5f59673e7f3a58ce439bbfb751/src/read_snapshot/particles_in_geometry/read_particles_in_geometry.jl#L1-L12">source</a></section><section><div><pre><code class="language-julia hljs">read_particles_in_geometry( filename::String, block::String,
                            geometry::AbstractGadgetGeometry;
                            parttype::Integer=0, verbose::Bool=true,
                            use_keys::Bool=true, do_shift_across_box_border::Bool=true)</code></pre><p>Reads all particles within a space defined by an <code>AbstractGeometry</code> struct for a given particle type.  Returns a dictionary with the requested block.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/e189626f83f4cc5f59673e7f3a58ce439bbfb751/src/read_snapshot/particles_in_geometry/read_particles_in_geometry.jl#L57-L65">source</a></section></article><p>You can use built-in geometries like <a href="../api/#GadgetIO.GadgetCube"><code>GadgetCube</code></a>, <a href="../api/#GadgetIO.GadgetSphere"><code>GadgetSphere</code></a> and <a href="../api/#GadgetIO.GadgetCylinder"><code>GadgetCylinder</code></a>.</p><p>If you want to extend the functionality you can define your own geometry as</p><pre><code class="language-julia hljs">struct YourGeometry{T} &lt;: AbstractGadgetGeometry
    prop1::Vector{T}
    prop2::Vector{T}
    prop3::T
    (...)
end</code></pre><p>and define the functions <a href="../api/#GadgetIO.get_geometry_box_corners-Tuple{GadgetCube}"><code>GadgetIO.get_geometry_box_corners</code></a> and <a href="../api/#GadgetIO.get_geometry_mask-Union{Tuple{T}, Tuple{GadgetCube, Matrix{T}}} where T"><code>GadgetIO.get_geometry_mask</code></a>. <a href="../api/#GadgetIO.get_geometry_box_corners-Tuple{GadgetCube}"><code>GadgetIO.get_geometry_box_corners</code></a> has to return a <code>Tuple</code> of two vectors which define the lower left and upper right corner of a box that contains the <code>geometry</code>. <a href="../api/#GadgetIO.get_geometry_mask-Union{Tuple{T}, Tuple{GadgetCube, Matrix{T}}} where T"><code>GadgetIO.get_geometry_mask</code></a> has to return an array of indices for which <code>pos</code> is contained in the <code>geometry</code>.</p><p>In all functions <code>parttype</code> defines the particle type to be read, as in the previous read functions and <code>verbose</code> gives console output. There are also multiple dispatch versions of all functions available that only take a single <code>block</code> as input and return an array with the values instead of a dictionary.</p><h2 id="Peano-Hilbert-key-based-reading"><a class="docs-heading-anchor" href="#Peano-Hilbert-key-based-reading">Peano-Hilbert key based reading</a><a id="Peano-Hilbert-key-based-reading-1"></a><a class="docs-heading-anchor-permalink" href="#Peano-Hilbert-key-based-reading" title="Permalink"></a></h2><p>For large simulations Gadget distributes snapshots over multiple files. These files contain particles associated with specific Peano-Hilbert keys.</p><p>If you call <a href="#GadgetIO.read_particles_in_box"><code>read_particles_in_box</code></a> or <a href="#GadgetIO.read_particles_in_volume"><code>read_particles_in_volume</code></a> with the keyword argument <code>use_keys=true</code> (which is the default case) it constructs the peano hilbert keys, selects the relevant files and reads the particles from these files into a dictionary. This is considerably faster than the brute-force attempt.</p><h2 id="Brute-Force-Reading"><a class="docs-heading-anchor" href="#Brute-Force-Reading">Brute-Force Reading</a><a id="Brute-Force-Reading-1"></a><a class="docs-heading-anchor-permalink" href="#Brute-Force-Reading" title="Permalink"></a></h2><p>If you call <a href="#GadgetIO.read_particles_in_box"><code>read_particles_in_box</code></a> or <a href="#GadgetIO.read_particles_in_volume"><code>read_particles_in_volume</code></a> with the keyword argument <code>use_keys=false</code> it reads all particles over all distributed files which are contained in the requested subvolume. This takes quite a lot longer than the key based reading, but sometimes it&#39;s the only option. To speed this up you can apply the filtering only once and store the <a href="#Read-positions">Read positions</a>.</p><h2 id="Custom-Filtering"><a class="docs-heading-anchor" href="#Custom-Filtering">Custom Filtering</a><a id="Custom-Filtering-1"></a><a class="docs-heading-anchor-permalink" href="#Custom-Filtering" title="Permalink"></a></h2><p>If you want to read multiple blocks in a simulation whose snapshots have been distributed over a number of sub-snapshots you can use <a href="#GadgetIO.read_blocks_filtered"><code>read_blocks_filtered</code></a>.</p><article class="docstring"><header><a class="docstring-binding" id="GadgetIO.read_blocks_filtered" href="#GadgetIO.read_blocks_filtered"><code>GadgetIO.read_blocks_filtered</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">read_blocks_filtered( snap_base::String, blocks::Array{String};
                            filter_function::Union{Function, Nothing}=nothing, 
                            read_positions::Union{Dict, Nothing}=nothing, 
                            parttype::Integer=0, verbose::Bool=true )</code></pre><p>Reads the specified blocks from all distributed files where particles pass the <code>filter_function</code>, or are given by a <code>Dict</code> of <code>read_positions</code>. For <code>read_positions</code> please see <a href="../read_snapshots/#GadgetIO.find_read_positions"><code>find_read_positions</code></a>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/e189626f83f4cc5f59673e7f3a58ce439bbfb751/src/read_snapshot/distributed_files/read_distributed_files.jl#L32-L40">source</a></section></article><p>This will read the specified <code>blocks</code> for all particles that pass the <code>filter_function</code>. This can be useful if you don&#39;t know where the region you are interested in is located and don&#39;t have enough memory to read in all particles. Alternatively you can also provide a <code>Dict</code> with <code>read_positions</code> as described in <a href="#Read-positions">Read positions</a>.</p><h3 id="Filter-functions"><a class="docs-heading-anchor" href="#Filter-functions">Filter functions</a><a id="Filter-functions-1"></a><a class="docs-heading-anchor-permalink" href="#Filter-functions" title="Permalink"></a></h3><p>The <code>filter_function</code> can be any function that takes a <code>String</code> input and returns an <code>Array</code> of <code>Integer</code>s, or <code>CartesianCoordinates</code>. For example, if you want to filter all particles with a Mach number larger than 1:</p><pre><code class="language-julia hljs">function mach_gt_1(snap_file)
    mach = read_snap(snap_file, &quot;MACH&quot;, 0)
    sel  = findall( mach .&gt; 1.0 )
    return sel
end</code></pre><p>Or if you want to trick the function into reading all particles after all:</p><pre><code class="language-julia hljs">function pass_all(snap_file)
    h = read_header(snap_file)
    return collect(1:h.npart[1])
end</code></pre><p>As an example, to read positions, velocity and ID of all shocked particles from distributed snapshots use</p><pre><code class="language-julia hljs">blocks = [&quot;POS&quot;, &quot;VEL&quot;, &quot;ID&quot;]
data = read_blocks_filtered(snap_base, blocks, filter_function=mach_gt_1, parttype=0)</code></pre><p>Just as a reminder from above you can read single blocks into an array by using <a href="#GadgetIO.read_snap"><code>read_snap</code></a> and <a href="#GadgetIO.read_block"><code>read_block</code></a>:</p><pre><code class="language-julia hljs">pos = read_block(snap_base, &quot;POS&quot;, parttype=0)</code></pre><p>This requiers <code>GadgetIO.jl</code> v0.5 though.</p><h3 id="Read-positions"><a class="docs-heading-anchor" href="#Read-positions">Read positions</a><a id="Read-positions-1"></a><a class="docs-heading-anchor-permalink" href="#Read-positions" title="Permalink"></a></h3><p>To avoid having to filter all files each time you want to read a snapshot you can also split the steps. You can first filter the particles to find the positions of the particles within the data blocks with</p><article class="docstring"><header><a class="docstring-binding" id="GadgetIO.find_read_positions" href="#GadgetIO.find_read_positions"><code>GadgetIO.find_read_positions</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">find_read_positions( snap_base::String, filter_function::Function)</code></pre><p>Finds the number of particles and their storage location in a snapshot directory that pass the <code>filter_function</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/e189626f83f4cc5f59673e7f3a58ce439bbfb751/src/read_snapshot/distributed_files/find_read_positions.jl#L36-L40">source</a></section><section><div><pre><code class="language-julia hljs">find_read_positions( snap_base::String, geometry::AbstractGadgetGeometry;
                     parttype::Integer=0,
                     verbose::Bool=true )</code></pre><p>Finds the number of particles and their storage location in a snapshot directory that are contained in the space defined by <code>geometry</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/e189626f83f4cc5f59673e7f3a58ce439bbfb751/src/read_snapshot/distributed_files/find_read_positions.jl#L89-L95">source</a></section></article><p>and then save the result as a binary file with</p><article class="docstring"><header><a class="docstring-binding" id="GadgetIO.save_read_positions" href="#GadgetIO.save_read_positions"><code>GadgetIO.save_read_positions</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">save_read_positions(save_file::String, read_positions::Dict)</code></pre><p>Saves the relevant read-in positions to a binary file.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/e189626f83f4cc5f59673e7f3a58ce439bbfb751/src/read_snapshot/distributed_files/find_read_positions.jl#L154-L158">source</a></section></article><p>To re-use the <code>read_positions</code> you can load them from file using <a href="../api/#GadgetIO.load_read_positions-Tuple{String}"><code>load_read_positions</code></a></p><pre><code class="language-julia hljs">read_positions = load_read_positions(save_file)</code></pre><p>This can then be used to read any number of blocks with</p><pre><code class="language-julia hljs">blocks = [&quot;POS&quot;, &quot;VEL&quot;, &quot;ID&quot;]
data = read_blocks_filtered(snap_base, blocks, read_positions=read_positions, parttype=0)</code></pre><h2 id="Reading-particles-by-referenced-ID"><a class="docs-heading-anchor" href="#Reading-particles-by-referenced-ID">Reading particles by referenced ID</a><a id="Reading-particles-by-referenced-ID-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-particles-by-referenced-ID" title="Permalink"></a></h2><p>If you want to select specific particles to read from an array of <code>IDs</code> you can do this with</p><article class="docstring"><header><a class="docstring-binding" id="GadgetIO.read_particles_by_id" href="#GadgetIO.read_particles_by_id"><code>GadgetIO.read_particles_by_id</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">read_particles_by_id(snap_base::String, ids::Array{&lt;:Integer}, 
                     blocks::Array{String}; 
                     parttype::Integer=0, verbose::Bool=true,
                     pos0::Array{&lt;:Real}=[-1.234, -1.234, -1.234],
                     r0::Real=0.0)</code></pre><p>Reads particles filtered by the provided IDs. Returns all requested blocks as entries in a <code>Dict</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/e189626f83f4cc5f59673e7f3a58ce439bbfb751/src/read_snapshot/particles_in_halo/read_particles_by_id.jl#L27-L35">source</a></section><section><div><pre><code class="language-julia hljs">read_particles_by_id(snap_base::String, ids::Array{&lt;:Integer}, 
                     block::String; 
                     parttype::Integer=0, verbose::Bool=true,
                     pos0::Array{&lt;:Real}=[-1.234, -1.234, -1.234],
                     r0::Real=0.0)</code></pre><p>Reads particles filtered by the provided IDs. Returns the requested block as an <code>Array</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/e189626f83f4cc5f59673e7f3a58ce439bbfb751/src/read_snapshot/particles_in_halo/read_particles_by_id.jl#L89-L97">source</a></section></article><p><code>snap_base</code> defines the target snapshot, or the snapshot basename, <code>selected_ids</code> contains the list of IDs of the particles you want to read and <code>blocks</code> containes the blocknames of the blocks you want to read. If the simulation is too large to read the whole snapshot into memory you can give values for <code>pos0</code> and <code>r0</code> to read only a specific region with <a href="#GadgetIO.read_particles_in_volume"><code>read_particles_in_volume</code></a>. See <a href="#Read-Subvolumes">Read Subvolumes</a> for details on this.</p><p>This will return a dictionary with all requested blocks.</p><h2 id="Example"><a class="docs-heading-anchor" href="#Example">Example</a><a id="Example-1"></a><a class="docs-heading-anchor-permalink" href="#Example" title="Permalink"></a></h2><p>If you want to, e.g. read positions, velocities, masses, density and hsml for all gas particles within the virial radius of the most massive halo of a simulation you can do this as follows.</p><p>Assuming <code>pos_halo</code> is the position of the center of mass of the halo and <code>r_vir</code> is its virial radius you read the data with</p><pre><code class="language-julia hljs">blocks = [&quot;POS&quot;, &quot;VEL&quot;, &quot;MASS&quot;, &quot;RHO&quot;, &quot;HSML&quot;]

data   = read_particles_in_volume(filename, blocks, pos_halo, r_vir,
                                  parttype=0,
                                  verbose=true)</code></pre><p>This will return a dictionary with the blocks as keys and containing the arrays for the particles.</p><pre><code class="language-julia hljs">data[&quot;POS&quot;]  # array of positions
data[&quot;RHO&quot;]  # array of densities
(...)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../file_infos/">« File Infos</a><a class="docs-footer-nextpage" href="../read_subfind/">Reading Subfind »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Wednesday 5 April 2023 16:03">Wednesday 5 April 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
