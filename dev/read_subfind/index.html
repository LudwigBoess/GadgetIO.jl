<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Reading Subfind · GadgetIO.jl</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.0/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">GadgetIO.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Table of Contents</a></li><li><a class="tocitem" href="../install/">Install</a></li><li><a class="tocitem" href="../file_infos/">File Infos</a></li><li><a class="tocitem" href="../read_snapshots/">Reading Snapshots</a></li><li class="is-active"><a class="tocitem" href>Reading Subfind</a><ul class="internal"><li><a class="tocitem" href="#Reading-the-header"><span>Reading the header</span></a></li><li><a class="tocitem" href="#Reading-the-subfind-files"><span>Reading the subfind files</span></a></li><li><a class="tocitem" href="#Filtered-read-in"><span>Filtered read-in</span></a></li><li><a class="tocitem" href="#Reading-halo-property-by-HaloID"><span>Reading halo property by HaloID</span></a></li><li><a class="tocitem" href="#Relating-to-Magneticum"><span>Relating to Magneticum</span></a></li><li><a class="tocitem" href="#Reading-particles-in-a-halo"><span>Reading particles in a halo</span></a></li></ul></li><li><a class="tocitem" href="../write_data/">Writing Data</a></li><li><a class="tocitem" href="../api/">API reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Reading Subfind</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Reading Subfind</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/master/docs/src/read_subfind.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Read-Subfind-Data"><a class="docs-heading-anchor" href="#Read-Subfind-Data">Read Subfind Data</a><a id="Read-Subfind-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Read-Subfind-Data" title="Permalink"></a></h1><p><code>Gadget</code> contains an on-the-fly halo-finder as described in <a href="https://ui.adsabs.harvard.edu/link_gateway/2001MNRAS.328..726S/doi:10.1046/j.1365-8711.2001.04912.x">Springel et al (2001)</a> or <a href="https://ui.adsabs.harvard.edu/link_gateway/2009MNRAS.399..497D/doi:10.1111/j.1365-2966.2009.15034.x">Dolag et al (2009)</a>. This sections provides an overview of the functions you can use to work with this output. Please note that you need to compile <code>Gadget</code> with <code>WRITE_SUB_IN_SNAP_FORMAT</code> to use this functionality.</p><h2 id="Reading-the-header"><a class="docs-heading-anchor" href="#Reading-the-header">Reading the header</a><a id="Reading-the-header-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-the-header" title="Permalink"></a></h2><p>As in the normal snapshot the subfind output also contains a <code>HEAD</code> block with useful information. You can read the header of the subfind output into a <a href="../api/#GadgetIO.SubfindHeader"><code>SubfindHeader</code></a> object</p><pre><code class="language-julia">struct SubfindHeader
    nhalos::Int32                       # number of halos in the output file
    nsubhalos::Int32                    # number of subhalos in the output file
    nfof::Int32                         # number of particles in the FoF
    ngroups::Int32                      # number of large groups in the output file
    time::Float64                       # time / scale factor of the simulation
    z::Float64                          # redshift of the simulation
    tothalos::UInt32                    # total number of halos over all output files
    totsubhalos::UInt32                 # total number of subhalos over all output files
    totfof::UInt32                      # total number of particles in the FoF
    totgroups::UInt32                   # total number of large groups over all output files
    num_colors::Int32                   # number of colors
    boxsize::Float64                    # total size of the simulation box
    omega_0::Float64                    # Omega matter
    omega_l::Float64                    # Omega dark enery
    h0::Float64                         # little h
    flag_doubleprecision::Int32         # 1 if snapshot is in double precision, else 0
    flag_ic_info::Int32
end</code></pre><p>using</p><pre><code class="language-julia">h = read_subfind_header(filename::String)</code></pre><h2 id="Reading-the-subfind-files"><a class="docs-heading-anchor" href="#Reading-the-subfind-files">Reading the subfind files</a><a id="Reading-the-subfind-files-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-the-subfind-files" title="Permalink"></a></h2><p>For convenience you can use a helper function provided by <code>GadgetIO</code> to read the block of the subfind output. Since each of the blocks is only relevant for either halos, subhalos, Fof or large groups you don&#39;t need to define a particly type, aka halo type in this case.</p><p>So in order to read the virial radius of the halos in a file you can simply use</p><pre><code class="language-julia">R_vir = read_subfind(filename, &quot;RVIR&quot;)</code></pre><h2 id="Filtered-read-in"><a class="docs-heading-anchor" href="#Filtered-read-in">Filtered read-in</a><a id="Filtered-read-in-1"></a><a class="docs-heading-anchor-permalink" href="#Filtered-read-in" title="Permalink"></a></h2><p>If you want to read specific halos from the subfind output you can use the function</p><pre><code class="language-julia">filter_subfind(filebase::String, blockname::String, filter_function::Function, nfiles::Integer=1)</code></pre><p>This will return an array of <a href="@ref">HaloID</a>s </p><pre><code class="language-julia">struct HaloID
    file::Int64
    id::Int64
end</code></pre><p>You can use this to read specific files with <a href="../api/#GadgetIO.read_subfind-Tuple{String, String}"><code>read_subfind</code></a> and select the array entry via the <code>id</code> field.</p><p>The <code>filter_function</code> argument takes any function that takes one input argument and returns <code>true</code> if the requirement is fulfilled, or <code>false</code> if not.</p><p>So to find e.g. all halos with a virial mass largert than <span>$10^{15} M_\odot$</span> you can use</p><pre><code class="language-julia">find_mass_gt_1e15(M) = ( (M &gt; 1.e15) ? true : false )

filtered_subfind = filter_subfind(filebase, &quot;MVIR&quot;, find_mass_gt_1e15)</code></pre><p>This will search all subfind files in the directory and check if they fulfill the filter. Since halos in subfind files are sorted by mass you can also supply a number of files to search with the argument <code>nfiles</code>. That way, if you are looking for a very massive halo you can constrian the reading and filtering to only the first <code>N</code> files to save time.</p><p>If you want more complex filtering you can also just pass a <code>filter_function</code> that takes a filename as an input and returns an <code>Array</code> of <code>Integer</code>s, or <code>CartesianCoordinates</code>, like was the case in <a href="../read_snapshots/#Filter-functions">Filter functions</a>.</p><pre><code class="language-julia">filtered_subfind = filter_subfind(filebase, filter_function)</code></pre><h2 id="Reading-halo-property-by-HaloID"><a class="docs-heading-anchor" href="#Reading-halo-property-by-HaloID">Reading halo property by HaloID</a><a id="Reading-halo-property-by-HaloID-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-halo-property-by-HaloID" title="Permalink"></a></h2><p>You can read any property of the halo that passed the <code>filter_function</code> (see <a href="#Filtered-read-in">Filtered read-in</a>) by using <a href="../api/#GadgetIO.read_halo_prop-Tuple{String, HaloID, String}"><code>read_halo_prop</code></a>. So if you want to read e.g. the virial radius for the first halo that passed your <code>filter_function</code></p><pre><code class="language-julia">mvir = read_halo_prop(filebase, filtered_subfind[1], &quot;MVIR&quot;)</code></pre><h2 id="Relating-to-Magneticum"><a class="docs-heading-anchor" href="#Relating-to-Magneticum">Relating to Magneticum</a><a id="Relating-to-Magneticum-1"></a><a class="docs-heading-anchor-permalink" href="#Relating-to-Magneticum" title="Permalink"></a></h2><p>If you work with the Magneticum simulation you may be given a global halo id. To read a halo property from a global halo id and convert it to a <code>HaloID</code> you can use <a href="../api/#GadgetIO.read_halo_prop_and_id"><code>read_halo_prop_and_id</code></a>. So for example if you have the global halo id <code>i_global</code> and want to read the corresponding virial mass you can use</p><pre><code class="language-julia">mvir, halo_id = read_halo_prop_and_id(filebase, i_global, &quot;MVIR&quot;)</code></pre><h2 id="Reading-particles-in-a-halo"><a class="docs-heading-anchor" href="#Reading-particles-in-a-halo">Reading particles in a halo</a><a id="Reading-particles-in-a-halo-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-particles-in-a-halo" title="Permalink"></a></h2><p>If you want to read all particles associated with a FoF halo you can do this with the function <a href="../api/#GadgetIO.read_particles_in_halo-Tuple{String, Array{String, N} where N, String, HaloID}"><code>read_particles_in_halo</code></a></p><pre><code class="language-julia">read_particles_in_halo( snap_base::String,   blocks::Array{String},
                        sub_base::String,    halo::HaloID; 
                        rad_scale::Real=1.0, halo_type::Integer=1,
                        parttype::Integer=0, verbose::Bool=true)</code></pre><p>This reads all blocks defined in <code>blocks</code> for the <code>halo</code> into a dictionary. <code>snap_base</code> and <code>sub_base</code> should point to the snap and subfind filebase as in other functions, or the files if you only have one file. The <code>HaloID</code> point to the selected halo. <code>halo_type</code> should be set to <code>1</code> for halos and <code>2</code> for subhalos.  If you didn&#39;t get all the particles you were looking for it might be that the search radius for the read-in was too small. <code>rad_scale</code> defines the multiplication factor for the search radius. For halos the default search radius is <span>$r_{200}$</span> and for subhalos it&#39;s the half-mass radius.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../read_snapshots/">« Reading Snapshots</a><a class="docs-footer-nextpage" href="../write_data/">Writing Data »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 27 May 2021 09:55">Thursday 27 May 2021</span>. Using Julia version 1.6.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
