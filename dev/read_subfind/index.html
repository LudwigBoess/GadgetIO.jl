<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Reading Subfind · GadgetIO.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../">GadgetIO.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Table of Contents</a></li><li><a class="tocitem" href="../install/">Install</a></li><li><a class="tocitem" href="../file_infos/">File Infos</a></li><li><a class="tocitem" href="../read_snapshots/">Reading Snapshots</a></li><li class="is-active"><a class="tocitem" href>Reading Subfind</a><ul class="internal"><li><a class="tocitem" href="#Reading-the-header"><span>Reading the header</span></a></li><li><a class="tocitem" href="#Reading-the-subfind-files"><span>Reading the subfind files</span></a></li><li><a class="tocitem" href="#Filtered-read-in"><span>Filtered read-in</span></a></li><li><a class="tocitem" href="#Saving/Loading-HaloIDs"><span>Saving/Loading HaloIDs</span></a></li><li><a class="tocitem" href="#Reading-halo-property-by-HaloID"><span>Reading halo property by HaloID</span></a></li><li><a class="tocitem" href="#Reading-halo-properties-by-global-halo-index"><span>Reading halo properties by global halo index</span></a></li><li><a class="tocitem" href="#Converting-global-halo-indices-to-HaloIDs"><span>Converting global halo indices to HaloIDs</span></a></li><li><a class="tocitem" href="#Reading-particles-in-a-halo"><span>Reading particles in a halo</span></a></li></ul></li><li><a class="tocitem" href="../write_data/">Writing Data</a></li><li><a class="tocitem" href="../api/">API reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Reading Subfind</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Reading Subfind</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/master/docs/src/read_subfind.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Read-Subfind-Data"><a class="docs-heading-anchor" href="#Read-Subfind-Data">Read Subfind Data</a><a id="Read-Subfind-Data-1"></a><a class="docs-heading-anchor-permalink" href="#Read-Subfind-Data" title="Permalink"></a></h1><p><code>Gadget</code> contains an on-the-fly halo-finder as described in <a href="https://ui.adsabs.harvard.edu/link_gateway/2001MNRAS.328..726S/doi:10.1046/j.1365-8711.2001.04912.x">Springel et al (2001)</a> or <a href="https://ui.adsabs.harvard.edu/link_gateway/2009MNRAS.399..497D/doi:10.1111/j.1365-2966.2009.15034.x">Dolag et al (2009)</a>. This sections provides an overview of the functions you can use to work with this output. Please note that you need to compile <code>Gadget</code> with <code>WRITE_SUB_IN_SNAP_FORMAT</code> to use this functionality.</p><p>Please note that since subfind files are equivalent to snapshot files you can use the same functions as in if you <a href="../read_snapshots/#Read-Snapshot-Data">Read Snapshot Data</a>.</p><h2 id="Reading-the-header"><a class="docs-heading-anchor" href="#Reading-the-header">Reading the header</a><a id="Reading-the-header-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-the-header" title="Permalink"></a></h2><p>As in the normal snapshot the subfind output also contains a <code>HEAD</code> block with useful information. You can read the header of the subfind output into a <a href="../api/#GadgetIO.SubfindHeader"><code>SubfindHeader</code></a> object</p><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>SubfindHeader</code>. Check Documenter&#39;s build log for details.</p></div></div><p>by using</p><article class="docstring"><header><a class="docstring-binding" id="GadgetIO.read_subfind_header" href="#GadgetIO.read_subfind_header"><code>GadgetIO.read_subfind_header</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">read_subfind_header(filename::String)</code></pre><p>Reads the header of a subfind file or file base (without .0, .1, etc.) into a <a href="../api/#GadgetIO.SubfindHeader"><code>SubfindHeader</code></a> struct.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/632933170de4df334d0f32b0331f4e04d3637ab5/src/read_subfind/read_header.jl#L49-L53">source</a></section></article><h2 id="Reading-the-subfind-files"><a class="docs-heading-anchor" href="#Reading-the-subfind-files">Reading the subfind files</a><a id="Reading-the-subfind-files-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-the-subfind-files" title="Permalink"></a></h2><p>For convenience you can use a helper function provided by <code>GadgetIO.jl</code> to read the block of the subfind output. Since each of the blocks is only relevant for either halos, subhalos, FoF or large groups you don&#39;t need to define a particly type, aka halo type in this case.</p><article class="docstring"><header><a class="docstring-binding" id="GadgetIO.read_subfind" href="#GadgetIO.read_subfind"><code>GadgetIO.read_subfind</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">read_subfind(filename::String, blockname::String)</code></pre><p><strong>Example</strong></p><p>To read e.g. the virial radius of halos use</p><pre><code class="language-julia hljs">R_vir = read_subfind(filename, &quot;RVIR&quot;)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/632933170de4df334d0f32b0331f4e04d3637ab5/src/read_subfind/read_subfind.jl#L1-L9">source</a></section><section><div><pre><code class="language-julia hljs">read_subfind(filename::String, blockname::String, ids::AbstractVector{&lt;:Integer}; return_haloid::Bool=false)</code></pre><p>Reads the block at the given subfind indices (<code>ids</code>, 0-indexed).</p><p>If <code>return_haloid</code> is <code>true</code>, returns a tuple of the block array and the corresponding <code>HaloID</code>s.</p><p><strong>Example</strong></p><pre><code class="language-julia hljs"># Read the virial masses of the first four halos in subfind:
mvir = read_subfind(filebase, &quot;MVIR&quot;, [0, 1, 2, 3])

# or:
mvir, haloids = read_subfind(filebase, &quot;MVIR&quot;, [0, 1, 2, 3]; return_haloid=true)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/632933170de4df334d0f32b0331f4e04d3637ab5/src/read_subfind/read_subfind.jl#L29-L44">source</a></section></article><h2 id="Filtered-read-in"><a class="docs-heading-anchor" href="#Filtered-read-in">Filtered read-in</a><a id="Filtered-read-in-1"></a><a class="docs-heading-anchor-permalink" href="#Filtered-read-in" title="Permalink"></a></h2><p>If you want to read specific halos from the subfind output you can use the function</p><article class="docstring"><header><a class="docstring-binding" id="GadgetIO.filter_subfind" href="#GadgetIO.filter_subfind"><code>GadgetIO.filter_subfind</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">filter_subfind(sub_base::String, filter_function::Function, files=nothing)</code></pre><p>Filters all entries in a subfind file that fulfill the &#39;filter_funcion&#39; requirements and returns a <code>Vector</code> of <a href="@ref">HaloID</a>s.</p><p><strong>Examples</strong></p><pre><code class="language-julia hljs"># load packages
using GadgetIO, GadgetUnits

# define filter function
function find_mvir_gt_1e15(filename) 
    h = read_header(filename)
    GU = GadgetPhysical(h) # unit conversion

    # read Mvir and convert to solar masses 
    M = read_subfind(filename, &quot;MVIR&quot;) .* GU.m_msun

    return findall(M .&gt; 1.0e15)
end

# basename of subfind output (without .*)
sub_base = /path/to/groups_000/sub_000

# get relevant halos from first 10 files
halo_ids = filter_subfind(sub_base, find_mvir_gt_1e15, 0:9)</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/632933170de4df334d0f32b0331f4e04d3637ab5/src/read_subfind/filter_subfind.jl#L59-L88">source</a></section></article><p>This will return an array of <a href="@ref">HaloID</a>s </p><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>HaloID</code>. Check Documenter&#39;s build log for details.</p></div></div><p>This can be used either with <a href="#Reading-halo-property-by-HaloID">Reading halo property by HaloID</a> </p><h2 id="Saving/Loading-HaloIDs"><a class="docs-heading-anchor" href="#Saving/Loading-HaloIDs">Saving/Loading HaloIDs</a><a id="Saving/Loading-HaloIDs-1"></a><a class="docs-heading-anchor-permalink" href="#Saving/Loading-HaloIDs" title="Permalink"></a></h2><p>If you do complex filtering and want to save the result you can use</p><article class="docstring"><header><a class="docstring-binding" id="GadgetIO.save_halo_ids" href="#GadgetIO.save_halo_ids"><code>GadgetIO.save_halo_ids</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">save_halo_ids(filename::String, halo_ids::Vector{HaloID})</code></pre><p>Writes a <code>Vector</code> of <a href="@ref">HaloID</a>s to a files.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/632933170de4df334d0f32b0331f4e04d3637ab5/src/read_subfind/halo_ids.jl#L177-L181">source</a></section></article><p>and load them the next time with </p><article class="docstring"><header><a class="docstring-binding" id="GadgetIO.load_halo_ids" href="#GadgetIO.load_halo_ids"><code>GadgetIO.load_halo_ids</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">save_halo_ids(filename::String)</code></pre><p>Loads a <code>Vector</code> of <a href="@ref">HaloID</a>s from a file.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/632933170de4df334d0f32b0331f4e04d3637ab5/src/read_subfind/halo_ids.jl#L192-L196">source</a></section></article><p>If you want to use <a href="../api/#GadgetIO.HaloID"><code>HaloID</code></a>s with <a href="@ref"><code>read_block_filtered</code></a> you can convert convert the <a href="../api/#GadgetIO.HaloID"><code>HaloID</code></a>s to <code>read_positions</code> by using</p><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>halo_ids_to_read_positions</code>. Check Documenter&#39;s build log for details.</p></div></div><h2 id="Reading-halo-property-by-HaloID"><a class="docs-heading-anchor" href="#Reading-halo-property-by-HaloID">Reading halo property by HaloID</a><a id="Reading-halo-property-by-HaloID-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-halo-property-by-HaloID" title="Permalink"></a></h2><p>You can read any property of the halo that passed the <code>filter_function</code> (see <a href="#Filtered-read-in">Filtered read-in</a>) by using </p><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>read_halo_prop(::Any, ::AbstractString, ::HaloID)</code>. Check Documenter&#39;s build log for details.</p></div></div><p>So if you want to read e.g. the virial radius for the first halo that passed your <code>filter_function</code></p><pre><code class="language-julia hljs">mvir = read_halo_prop(filebase, filtered_subfind[1], &quot;MVIR&quot;)</code></pre><p>HaloIDs can also be obtained in a vector of all halos by setting the keyword parameter <code>return_haloid</code> to <code>true</code>:</p><pre><code class="language-julia hljs">mvir, haloids = read_subfind(filename, &quot;MVIR&quot;; return_haloid=true)</code></pre><h2 id="Reading-halo-properties-by-global-halo-index"><a class="docs-heading-anchor" href="#Reading-halo-properties-by-global-halo-index">Reading halo properties by global halo index</a><a id="Reading-halo-properties-by-global-halo-index-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-halo-properties-by-global-halo-index" title="Permalink"></a></h2><p>If you have a global index of a halo from subfind (0-indexed, increasing over all subfiles of the subfind outputs), you can also read a halo&#39;s properties from subfind. To read a halo property from such a global halo index and convert it to a <code>HaloID</code> you can use </p><article class="docstring"><header><a class="docstring-binding" id="GadgetIO.read_halo_prop_and_id" href="#GadgetIO.read_halo_prop_and_id"><code>GadgetIO.read_halo_prop_and_id</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">read_halo_prop_and_id(filebase, i_global::Integer, blockname::AbstractString; kwargs...)</code></pre><p>Get halo property and <a href="../api/#GadgetIO.HaloID"><code>HaloID</code></a> from block <code>blockname</code> by global halo index <code>i_global</code> (zero-based index). <code>nfiles</code> should generally be set to <code>h.num_files</code>, obtained from <code>read_header</code>. When nfiles is not passed, it is read automatically from the header.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/632933170de4df334d0f32b0331f4e04d3637ab5/src/read_subfind/read_halo_prop.jl#L36-L42">source</a></section></article><p>To only obtain the property use</p><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>read_halo_prop(::Any, ::AbstractString, ::Integer)</code>. Check Documenter&#39;s build log for details.</p></div></div><p>So for example if you have the global halo id <code>i_global</code> and want to read the corresponding virial mass you can use one of the two following lines (note that it is faster to read properties via the HaloID since only a single file has to be read for that):</p><pre><code class="language-julia hljs">mvir, halo_id = read_halo_prop_and_id(filebase, i_global, &quot;MVIR&quot;)
mvir = read_halo_prop(filebase, i_global, &quot;MVIR&quot;)</code></pre><p>To read the properties of multiple halos for which the halo indices are available, use one of the following two lines (to read the virial masses of the first four halos in subfind):</p><pre><code class="language-julia hljs">mvir = read_subfind(filebase, &quot;MVIR&quot;, [0, 1, 2, 3])
mvir, haloids = read_subfind(filebase, &quot;MVIR&quot;, [0, 1, 2, 3]; return_haloid=true)</code></pre><p>The results are returned in the order of the given indices.</p><h2 id="Converting-global-halo-indices-to-HaloIDs"><a class="docs-heading-anchor" href="#Converting-global-halo-indices-to-HaloIDs">Converting global halo indices to HaloIDs</a><a id="Converting-global-halo-indices-to-HaloIDs-1"></a><a class="docs-heading-anchor-permalink" href="#Converting-global-halo-indices-to-HaloIDs" title="Permalink"></a></h2><p>If you want to convert global halo indices to <a href="../api/#GadgetIO.HaloID"><code>HaloID</code></a>s use</p><div class="admonition is-warning"><header class="admonition-header">Missing docstring.</header><div class="admonition-body"><p>Missing docstring for <code>global_idxs_to_halo_id</code>. Check Documenter&#39;s build log for details.</p></div></div><p>You can then save the <code>HaloID</code>s with <a href="#Saving/Loading-HaloIDs">Saving/Loading HaloIDs</a> or convert them to <code>read_positions</code> with <a href="@ref"><code>halo_ids_to_read_positions</code></a>.</p><h2 id="Reading-particles-in-a-halo"><a class="docs-heading-anchor" href="#Reading-particles-in-a-halo">Reading particles in a halo</a><a id="Reading-particles-in-a-halo-1"></a><a class="docs-heading-anchor-permalink" href="#Reading-particles-in-a-halo" title="Permalink"></a></h2><p>If you want to read all particles associated with a FoF halo you can do this with the function </p><article class="docstring"><header><a class="docstring-binding" id="GadgetIO.read_particles_in_halo" href="#GadgetIO.read_particles_in_halo"><code>GadgetIO.read_particles_in_halo</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia hljs">read_particles_in_halo(snap_base::String, blocks::Array{String},
                            sub_base::String, halo::HaloID; 
                            radius::Union{Real,Nothing}=nothing,
                            rad_scale::Real=1.0, halo_type::Integer=1,
                            parttype::Integer=0, verbose::Bool=true,
                            use_keys::Bool=true)</code></pre><p>Reads all particles of type <code>parttype</code> that are contained in a halo defined by its <code>HaloID</code>. If <code>radius</code> is given (in simulation units), particles are read within at least this radius times <code>rad_scale</code>. Otherwise, R200, RMEA, or RHMS times <code>rad_scale</code> is used depending on <code>halo_type</code> (1, 1, and 2, respectively). Returns a <code>Dict</code> with each of the <code>blocks</code> as entries.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/632933170de4df334d0f32b0331f4e04d3637ab5/src/read_snapshot/particles_in_halo/read_particles_in_halo.jl#L194-L207">source</a></section><section><div><pre><code class="language-julia hljs">read_particles_in_halo( snap_base::String, block::String,
                        sub_base::String, halo::HaloID; 
                        kwargs...)</code></pre><p>Reads all particles of type <code>parttype</code> that are contained in a halo defined by its <code>HaloID</code>. If <code>radius</code> is given (in simulation units), particles are read within at least this radius times <code>rad_scale</code>. Otherwise, R200, RMEA, or RHMS times <code>rad_scale</code> is used depending on <code>halo_type</code> (1, 1, and 2, respectively). Returns an <code>Array</code> with the requested <code>block</code>.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/LudwigBoess/GadgetIO.jl/blob/632933170de4df334d0f32b0331f4e04d3637ab5/src/read_snapshot/particles_in_halo/read_particles_in_halo.jl#L266-L276">source</a></section></article><p>This reads all blocks defined in <code>blocks</code> for the <code>halo</code> into a dictionary. <code>snap_base</code> and <code>sub_base</code> should point to the snap and subfind filebase as in other functions, or the files if you only have one file. The <code>HaloID</code> point to the selected halo. <code>halo_type</code> should be set to <code>1</code> for halos and <code>2</code> for subhalos.  If you didn&#39;t get all the particles you were looking for it might be that the search radius for the read-in was too small. <code>rad_scale</code> defines the multiplication factor for the search radius. For halos the default search radius is <span>$r_{200}$</span> and for subhalos it&#39;s the half-mass radius.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../read_snapshots/">« Reading Snapshots</a><a class="docs-footer-nextpage" href="../write_data/">Writing Data »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.23 on <span class="colophon-date" title="Monday 2 January 2023 18:00">Monday 2 January 2023</span>. Using Julia version 1.8.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
